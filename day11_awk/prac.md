#awk

> awk 用来处理文本数据的神器。非常的擅长处理结构化数据和生成表单，和sed、grep相似.
>
> awk 主要有两个概念，一个是动作，一个是模式。
>
> 模式相当于条件语句, 或者正则表达式，用来匹配符合条件的文本。然后执行对应的动作，常用的动作就是printf输出函数。awk参考C语言，所以语法大部分一样。
>
> awk 的原理是：通过一行行的读取文件或者文本数据的内容。一行行的匹配所有模式，然后执行对应动作。



## 常用参数

### -F

>分隔符参数，用来说明如何将要处理的文本数据进行分割。按什么符号进行分割。



## 内置变量

### ARGC、ARGV

> 和C语言中一样，ARGV用来表示传进来的参数，如ARGV[0]表示命令文件名，就是awk。ARGC表示命令行的参数的个数

### FILENAME、NR、NF

> 分别表示当前文件名、当前行的行号、当前行的列数量

其他的内置变量参考官方文档。



## 使用例子

### 查看所有进程的进程号

`ps | awk -F ' ' {printf("%s\n",$1)}`

> 可以和kill命令结合, 一次性杀掉所有进程
>
> -F 表示分隔符号



### 统计某个文件夹下的文件占用字节数

`ls -l |awk 'BEGIN {size=0;} {size=size+$5;} END{print "[end]size is ", size}'`



### 具体例子

> | Beth  | 4.00 | 0    |
> | ----- | ---- | ---- |
> | Dan   | 3.75 | 0    |
> | kathy | 4.00 | 10   |
> | Mark  | 5.00 | 20   |
> | Mary  | 5.50 | 22   |
> | Susie | 4.25 | 18   |

假设有以上数据, 存在emp.data中。每一行一个三列，表示员工姓名，薪资，工作小时数。现在统计工作时间大于0的员工，并计算薪资。

`awk '$3 >0 { print $1, $2 * $3 }' emp.data`



如果awk程序比较长，那么可以将脚本编写在文件中，方便维护阅读和执行。假设有叫profile的awk脚本文件。执行方式为

`awk -f profile inputFile`



假设你想打印所有员工的数据，包括他们的薪资，并按照递增顺序排序。此时可以用awk和sort结合使用。

`awk '{ printf("%6.2f    %s\n", $2 * $3, $0) }' emp.data | sort`



BEGIN和END

> 特殊模式 BEGIN 用于匹配第一个输入文件的第一行之前的位置，或者说表示文件开始， END 则用于匹配处理过的最后一个文件的最后一行之后的位置，或者说表示文件结束

```bash
awk 'BEGIN { print "Name    RATE    HOURS"; print ""}
      { print }' emp.data
```

如上该命令用来给文本数据输出一个标题。其中BEGIN用来在emp.data第一行之前加入数据



统计工作超过15个小时的员工的数目

```bash
awk '$3 > 15 { emp = emp + 1 }
END     { print emp, "employees worked more than 15 hours" }' emp.data
```



#### 模式总结

- 简单条件模式 `$2 > 5`、`$1 == "Susie"`.（包含基本四则运算，字符串比较，数字比较）
- 复合模式。使用&&和||和!组合的简单模式。
- 特殊模式，BEGIN用于匹配第一个输入文件的第一行之前、END 匹配处理后的最后一个文件的最后一行之前的位置



## OSX使用

无



## 使用注意

- 一般使用printf，不推荐print。因为printf用法和C一模一样, 其次其方便定制复杂输出。
- 熟悉常见的内置变量ARGC、ARGV、FILENAME、NR、NF
- awk也是一门脚本语言，还有许多更加复杂的操作。具体可以看提供的参考链接



## 练习

- 打印出工作时间超过零小时的员工的姓名和工资（薪资乘以时间）
- 打印出还没工作过的员工的姓名



## 参考

http://awk.readthedocs.io/en/latest/chapter-one.html



